name: Org User Inviter
on:
  issues:
    types: [labeled]

jobs:
  automate_invite:
    runs-on: ubuntu-latest
    steps:
      - name: Invite on label
        uses: vj-abigo/invite-on-label@v1.2
        with:
          organization: layer5io
          label: issue/invite
          repo-token: ${{ secrets.GITHUB_TOKEN }}
          comment: "We are sending you an invitation to join the Layer5 GitHub Organization. :partying_face: <b>Welcome to the community! ðŸŽ‰</b><br /><br />&nbsp;&nbsp;&nbsp;Be sure to :star: [star the projects](../stargazers), if you haven't already. :smile:<br />"
        env:
          INVITE_TOKEN: ${{ secrets.RELEASEDRAFTER_PAT }}

      - name: View context attributes
        uses: actions/github-script@v4
        id: set-name
        with:
          script: return context.issue.url
          result-encoding: string
        env:
          ISSUE_URL: context.issue.url

      - name: Get name
        run: echo "NAME=${{steps.set-name.outputs.result}}"" >> $GITHUB_ENV

      - name: Notify slack
        env:
          SLACK_BOT_TOKEN: ${{ secrets.SLACK_BOT_TOKEN }}
        uses: pullreminders/slack-action@master
        with:
          args: '{\"channel\":\"CF9RK4H89\",\"text\":\"Someone has been invited the the layer5io GitHub org: ${{env.NAME}}\"}'
